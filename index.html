<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OPSUCHT Shards Kurse</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --bg: #0b0f14;
  --card: #111822;
  --muted: #8b93a7;
  --text: #ffffff;
  --accent: #2dd4bf;
  --green: #22c55e;
  --red: #ef4444;
}

* { box-sizing: border-box; font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif; }

body {
  margin: 0;
  background: radial-gradient(circle at top, #101826, #070b11);
  color: var(--text);
}

.container {
  max-width: 720px;
  margin: auto;
  padding: 16px;
}

h1 {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 20px;
}

.card {
  background: linear-gradient(180deg, #121a25, #0c121a);
  border-radius: 18px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.5);
}

.grid2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.price {
  font-size: 32px;
  font-weight: 700;
}

.muted { color: var(--muted); font-size: 14px; }

.selector {
  display: flex;
  gap: 10px;
  margin-bottom: 12px;
}

.selector button {
  flex: 1;
  background: #0f1622;
  border: 1px solid #1f2937;
  color: white;
  padding: 10px;
  border-radius: 10px;
  font-size: 16px;
}

.selector button.active {
  background: #1f2937;
  border-color: var(--accent);
}

input {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: 1px solid #1f2937;
  background: #0b1220;
  color: white;
  font-size: 18px;
}

canvas {
  width: 100% !important;
  height: 260px !important;
}
</style>
</head>

<body>
<div class="container">

<h1>ðŸ’Ž OPSUCHT Shards Kurse</h1>

<div class="card">
  <div class="grid2">
    <div>
      <div class="muted">Diamond Block</div>
      <div class="price" id="diaShard">â€“</div>
      <div class="muted">Shards</div>
    </div>
    <div>
      <div class="muted">Netherite Ingot</div>
      <div class="price" id="netShard">â€“</div>
      <div class="muted">Shards</div>
    </div>
  </div>
</div>

<div class="card">
  <h3>Preis-Rechner</h3>

  <div class="selector">
    <button id="diaBtn" class="active">Diamond Block</button>
    <button id="netBtn">Netherite Ingot</button>
  </div>

  <input id="amount" type="number" value="1" min="0" step="1">

  <div style="margin-top:14px">
    <div class="muted" id="resultText">â€“</div>
    <div class="price" id="resultPrice">â€“</div>
  </div>
</div>

<div class="card">
  <h3>Preisverlauf</h3>
  <canvas id="chart"></canvas>
</div>

</div>

<script>
const SHARD_API = "https://api.opsucht.net/merchant/rates";
const DIA_USD = "https://api.opsucht.net/market/price/diamond_block";
const NET_USD = "https://api.opsucht.net/market/price/netherite_ingot";
const HISTORY = "history.json";

let mode = "diamond_block";
let diaShard = 0;
let netShard = 0;
let diaUsd = 0;
let netUsd = 0;

async function loadRates() {
  const shard = await fetch(SHARD_API).then(r=>r.json());
  diaShard = shard.find(i=>i.source==="diamond_block").exchangeRate;
  netShard = shard.find(i=>i.source==="netherite_ingot").exchangeRate;

  document.getElementById("diaShard").textContent = diaShard.toFixed(2);
  document.getElementById("netShard").textContent = netShard.toFixed(2);

  const dia = await fetch(DIA_USD).then(r=>r.json());
  const net = await fetch(NET_USD).then(r=>r.json());
  diaUsd = dia.price;
  netUsd = net.price;

  updateCalc();
  loadChart();
}

function updateCalc() {
  const amount = Number(document.getElementById("amount").value || 0);

  if (mode === "diamond_block") {
    document.getElementById("resultText").textContent =
      `${amount} Diamond Block = ${(amount*diaShard).toFixed(2)} OPSHards`;
    document.getElementById("resultPrice").textContent =
      `â‰ˆ ${(amount*diaUsd).toFixed(2)} $`;
  } else {
    document.getElementById("resultText").textContent =
      `${amount} Netherite Ingot = ${(amount*netShard).toFixed(2)} OPSHards`;
    document.getElementById("resultPrice").textContent =
      `â‰ˆ ${(amount*netUsd).toFixed(2)} $`;
  }
}

let chart;
async function loadChart() {
  const raw = await fetch(HISTORY).then(r=>r.json());

  const rows = [];
  raw.forEach(h=>{
    h.data.forEach(d=>{
      rows.push({
        time: new Date(h.time).toLocaleDateString(),
        source: d.source,
        value: d.exchangeRate
      });
    });
  });

  const filtered = rows.filter(r=>r.source===mode);

  const labels = filtered.map(r=>r.time);
  const data = filtered.map(r=>r.value);

  if (chart) chart.destroy();

  chart = new Chart(document.getElementById("chart"), {
    type: "line",
    data: {
      labels,
      datasets: [{
        data,
        borderColor: "#2dd4bf",
        backgroundColor: "rgba(45,212,191,0.15)",
        fill: true,
        tension: 0.35,
        pointRadius: 2
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false }},
      scales: {
        x: { ticks: { color: "#8b93a7" }},
        y: { ticks: { color: "#8b93a7" }}
      }
    }
  });
}

document.getElementById("diaBtn").onclick = () => {
  mode = "diamond_block";
  diaBtn.classList.add("active");
  netBtn.classList.remove("active");
  updateCalc();
  loadChart();
};

document.getElementById("netBtn").onclick = () => {
  mode = "netherite_ingot";
  netBtn.classList.add("active");
  diaBtn.classList.remove("active");
  updateCalc();
  loadChart();
};

document.getElementById("amount").oninput = updateCalc;

loadRates();
</script>
</body>
</html>
