<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OPSUCHT Shard Verlauf</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --bg:#070b11; --card:#0e1520; --text:#fff; --muted:#8b93a7; --accent:#2dd4bf;
}

*{box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif}
body{margin:0;background:radial-gradient(circle at top,#0f172a,#05070b);color:var(--text)}

header{
  display:flex;align-items:center;gap:14px;
  padding:14px 16px;font-size:20px;font-weight:700;
}

.menu{font-size:26px;text-decoration:none;color:white}

.container{max-width:900px;margin:auto;padding:16px}

.card{
  background:linear-gradient(180deg,#121a25,#0a0f17);
  border-radius:20px;padding:18px;margin-bottom:16px;
  box-shadow:0 10px 40px rgba(0,0,0,.6)
}

.grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}

.price{font-size:34px;font-weight:700}
.muted{color:var(--muted);font-size:14px}

.selector{display:flex;gap:10px;margin-bottom:12px}
.selector button{
  flex:1;background:#0f1622;border:1px solid #1f2937;
  color:white;padding:10px;border-radius:12px;font-size:16px
}
.selector button.active{border-color:var(--accent)}

canvas{width:100%!important;height:300px!important}

table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:10px;border-bottom:1px solid #1f2937;text-align:left}
th{color:#9ca3af}
</style>
</head>

<body>

<header>
  <a class="menu" href="stats.html">â˜°</a>
  ðŸ’Ž OPSUCHT Shard Verlauf
</header>

<div class="container">

<!-- ===== KURSE OBEN ===== -->

<div class="card grid2">
  <div>
    <div class="muted">Diamond Block</div>
    <div class="price" id="diaShard">â€“</div>
    <div class="muted">Shards</div>
  </div>
  <div>
    <div class="muted">Netherite Ingot</div>
    <div class="price" id="netShard">â€“</div>
    <div class="muted">Shards</div>
  </div>
</div>

<!-- ===== AUSWAHL ===== -->

<div class="card">
  <div class="selector">
    <button id="diaBtn" class="active">Diamond Block</button>
    <button id="netBtn">Netherite Ingot</button>
  </div>
</div>

<!-- ===== CHART ===== -->

<div class="card">
  <h3>Preisverlauf</h3>
  <canvas id="chart"></canvas>
</div>

<!-- ===== TABELLE ===== -->

<div class="card">
  <h3>Preisverlauf (Zahlen)</h3>
  <table>
    <thead>
      <tr><th>Zeit</th><th>Item</th><th>Wert</th></tr>
    </thead>
    <tbody id="table"></tbody>
  </table>
</div>

</div>

<script>
const SHARD_API="https://api.opsucht.net/merchant/rates";
const HISTORY="history.json";

let mode="diamond_block",diaShard=0,netShard=0,chart,rows=[];

async function loadRates(){
  const shard=await fetch(SHARD_API).then(r=>r.json());
  diaShard=shard.find(i=>i.source==="diamond_block").exchangeRate;
  netShard=shard.find(i=>i.source==="netherite_ingot").exchangeRate;

  diaShardEl.textContent=diaShard.toFixed(2);
  netShardEl.textContent=netShard.toFixed(2);
}

async function loadHistory(){
  const raw=await fetch(HISTORY).then(r=>r.json());
  rows=[];
  raw.forEach(h=>h.data.forEach(d=>rows.push({
    time:new Date(h.time).toLocaleString("de-DE"),
    source:d.source,value:d.exchangeRate
  })));
  render();
}

function render(){
  const f=rows.filter(r=>r.source===mode).reverse();

  // Tabelle
  table.innerHTML=f.map(r=>`
    <tr><td>${r.time}</td><td>${label(r.source)}</td><td>${r.value.toFixed(2)}</td></tr>
  `).join("");

  // Chart
  if(chart)chart.destroy();
  chart=new Chart(chartEl,{
    type:"line",
    data:{
      labels:f.map(r=>r.time),
      datasets:[{
        data:f.map(r=>r.value),
        borderColor:"#2dd4bf",
        backgroundColor:"rgba(45,212,191,.15)",
        fill:true,tension:.35,pointRadius:3
      }]
    },
    options:{
      interaction:{mode:"index",intersect:false},
      plugins:{legend:{display:false},tooltip:{enabled:true}},
      scales:{x:{ticks:{color:"#8b93a7"}},y:{ticks:{color:"#8b93a7"}}}
    }
  });
}

function label(s){
  return s==="diamond_block"?"Diamond Block":"Netherite Ingot";
}

diaBtn.onclick=()=>{mode="diamond_block";diaBtn.classList.add("active");netBtn.classList.remove("active");render()}
netBtn.onclick=()=>{mode="netherite_ingot";netBtn.classList.add("active");diaBtn.classList.remove("active");render()}

const diaShardEl=document.getElementById("diaShard");
const netShardEl=document.getElementById("netShard");
const chartEl=document.getElementById("chart");
const table=document.getElementById("table");

loadRates();
loadHistory();
</script>
</body>
</html>
